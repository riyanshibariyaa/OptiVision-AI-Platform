<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Leak Detection System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #FFFFFF;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Effects */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, 0.03) 2px,
                    rgba(0, 255, 255, 0.03) 4px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, 0.03) 2px,
                    rgba(0, 255, 255, 0.03) 4px
                );
            pointer-events: none;
            z-index: -2;
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #0066FF, transparent);
            animation: scanLine 3s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        /* Header */
        .neural-header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #0066FF;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .neural-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0066FF, #00AAFF);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            animation: float 3s ease-in-out infinite;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0066FF;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .logo-subtitle {
            font-size: 0.8rem;
            color: #0066FF;
            opacity: 0.8;
        }

        .back-btn {
            background: rgba(0, 102, 255, 0.1);
            border: 2px solid #0066FF;
            color: #0066FF;
            padding: 0.8rem 1.5rem;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        /* Main Container */
        .neural-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .monitor-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .monitor-title h1 {
            font-size: 3rem;
            font-weight: 700;
            color: #FFFFFF;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            margin-bottom: 1rem;
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        .monitor-title p {
            font-size: 1.1rem;
            color: #0066FF;
            opacity: 0.9;
        }

        /* Interface Grid */
        .interface-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .upload-interface {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0066FF;
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .interface-title {
            font-size: 1.5rem;
            color: #0066FF;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Monitoring Modes */
        .monitoring-modes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .mode-option {
            background: rgba(0, 102, 255, 0.1);
            border: 1px solid #0066FF;
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-option.active {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00AAFF;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .mode-option:hover {
            background: rgba(0, 255, 255, 0.15);
        }

        .mode-icon {
            font-size: 1.5rem;
            color: #0066FF;
            margin-bottom: 0.5rem;
        }

        .mode-title {
            color: #0066FF;
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #0066FF;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .upload-area:hover {
            border-color: #00AAFF;
            background: rgba(0, 255, 255, 0.05);
        }

        .upload-area.dragover {
            border-color: #00AAFF;
            background: rgba(0, 255, 255, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: #0066FF;
            margin-bottom: 1rem;
        }

        .upload-text {
            color: #0066FF;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            color: #0066FF;
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        /* Sensitivity Control */
        .sensitivity-control {
            margin-top: 1rem;
        }

        .control-label {
            font-family: 'Open Sans', sans-serif;
            color: #0066FF;
            font-weight: 500;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .value-display {
            color: #00AAFF;
            font-weight: 700;
        }

        .neural-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #000000, #0066FF);
            outline: none;
            -webkit-appearance: none;
            position: relative;
            overflow: hidden;
        }

        .neural-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0066FF;
            border: 2px solid #00AAFF;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        /* Process Button */
        .neural-process-btn {
            width: 100%;
            background: linear-gradient(135deg, #0066FF, #00AAFF);
            border: none;
            color: #FFFFFF;
            padding: 1.5rem 2rem;
            border-radius: 10px;
            font-family: 'Open Sans', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            margin-top: 1rem;
        }

        .neural-process-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.4);
        }

        .neural-process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Webcam Button */
        .webcam-btn {
            width: 100%;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00AAFF;
            color: #00AAFF;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-family: 'Open Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .webcam-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        /* Video Monitor */
        .video-monitor {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0066FF;
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .video-feed {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #000000;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-stream {
            width: 100%;
            height: auto;
            max-height: 500px;
            border-radius: 10px;
        }

        .feed-placeholder {
            text-align: center;
            color: #0066FF;
        }

        .feed-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .feed-placeholder p {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        /* Detection Controls */
        .detection-controls {
            display: none;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .detection-controls.active {
            display: flex;
        }

        .control-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #0066FF;
            color: #0066FF;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-family: 'Open Sans', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .control-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .control-btn.active {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Monitoring Statistics */
        .monitoring-stats {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0066FF;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            backdrop-filter: blur(10px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: rgba(0, 102, 255, 0.05);
            border: 1px solid #0066FF;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #0066FF;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            display: block;
            margin-bottom: 0.5rem;
            font-family: 'Open Sans', sans-serif;
        }

        .stat-label {
            color: #0066FF;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Status Messages */
        .status-message {
            background: rgba(0, 102, 255, 0.1);
            border: 1px solid #0066FF;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .status-message.success {
            border-color: #00FF00;
            background: rgba(0, 255, 0, 0.1);
            color: #00FF00;
        }

        .status-message.error {
            border-color: #FF0000;
            background: rgba(255, 0, 0, 0.1);
            color: #FF0000;
        }

        .status-message.warning {
            border-color: #FFA500;
            background: rgba(255, 165, 0, 0.1);
            color: #FFA500;
        }

        /* Loading Spinner */
        .neural-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.1);
            border-top: 4px solid #0066FF;
            border-right: 4px solid #0066FF;
            border-radius: 50%;
            animation: neuralSpin 1s linear infinite;
            margin: 2rem auto;
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        @keyframes scanLine {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }

        @keyframes neuralSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
            100% { text-shadow: 0 0 30px rgba(0, 255, 255, 1), 0 0 40px #0066FF; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .interface-grid {
                grid-template-columns: 1fr;
            }
            
            .monitor-title h1 {
                font-size: 2rem;
            }
            
            .neural-container {
                padding: 1rem;
            }
            
            .monitoring-modes {
                grid-template-columns: 1fr;
            }
            
            .detection-controls {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="matrix-bg"></div>
    <div class="grid-overlay"></div>
    <div class="scan-line"></div>

    <!-- Neural Header -->
    <header class="neural-header">
        <div class="neural-logo">
            <div class="logo-icon">
                <i class="fas fa-tint"></i>
            </div>
            <div>
                <div class="logo-text">NEURAL LEAK MONITOR</div>
                <div class="logo-subtitle">INFRASTRUCTURE MONITORING SYSTEM</div>
            </div>
        </div>
        
        <a href="/neural-dashboard" class="back-btn">
            <i class="fas fa-arrow-left"></i> NEURAL HUB
        </a>
    </header>

    <!-- Main Neural Container -->
    <div class="neural-container">
        <!-- Monitor Title -->
        <div class="monitor-title">
            <h1>NEURAL LEAK DETECTION</h1>
            <p>Real-time infrastructure monitoring with predictive leak analysis and advanced neural networks</p>
        </div>

        <!-- Main Interface -->
        <div class="interface-grid">
            <!-- Upload Interface -->
            <div class="upload-interface">
                <h2 class="interface-title">
                    <i class="fas fa-upload"></i>
                    VIDEO SOURCE INPUT
                </h2>

                <!-- Monitoring Modes -->
                <div class="monitoring-modes">
                    <div class="mode-option active" id="uploadMode">
                        <div class="mode-icon">
                            <i class="fas fa-file-video"></i>
                        </div>
                        <div class="mode-title">VIDEO UPLOAD</div>
                    </div>
                    <div class="mode-option" id="webcamMode">
                        <div class="mode-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="mode-title">LIVE CAMERA</div>
                    </div>
                </div>

                <!-- Upload Area -->
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">Click or drag video files here</div>
                    <div class="upload-hint">Supports MP4, AVI, MOV files</div>
                    <input type="file" id="videoFile" class="file-input" accept="video/*">
                </div>

                <!-- Webcam Button -->
                <button class="webcam-btn" id="webcamBtn" style="display: none;">
                    <i class="fas fa-video"></i> START LIVE MONITORING
                </button>

                <!-- Sensitivity Control -->
                <div class="sensitivity-control">
                    <div class="control-label">
                        <span>DETECTION SENSITIVITY</span>
                        <span class="value-display" id="sensitivityValue">75%</span>
                    </div>
                    <input type="range" class="neural-slider" id="sensitivitySlider" 
                           min="25" max="100" value="75" step="5">
                </div>

                <!-- Process Button -->
                <button class="neural-process-btn" id="processBtn" disabled>
                    <i class="fas fa-play"></i> INITIATE NEURAL MONITORING
                </button>

                <!-- Status Messages -->
                <div class="status-message" id="statusMessage"></div>
            </div>

            <!-- Video Monitor -->
            <div class="video-monitor">
                <h2 class="interface-title">
                    <i class="fas fa-desktop"></i>
                    NEURAL MONITORING FEED
                </h2>
                
                <div class="video-feed" id="videoFeed">
                    <div class="feed-placeholder" id="feedPlaceholder">
                        <i class="fas fa-video"></i>
                        <p>NEURAL MONITORING STANDBY</p>
                        <p>Awaiting video source for leak detection...</p>
                    </div>
                    <img class="video-stream" id="videoStream" style="display: none;" 
                         src="/api/neural/leak/stream" alt="Live Video Feed">
                </div>
                
                <div class="detection-controls" id="detectionControls">
                    <button class="control-btn" id="pauseBtn">
                        <i class="fas fa-pause"></i> PAUSE
                    </button>
                    <button class="control-btn" id="resumeBtn" style="display: none;">
                        <i class="fas fa-play"></i> RESUME
                    </button>
                    <button class="control-btn" id="stopBtn">
                        <i class="fas fa-stop"></i> TERMINATE
                    </button>
                    <button class="control-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> RESET
                    </button>
                </div>
            </div>
        </div>

        <!-- Monitoring Statistics
        <div class="monitoring-stats">
            <h2 class="interface-title">
                <i class="fas fa-chart-line"></i>
                NEURAL MONITORING STATISTICS
            </h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-eye stat-icon"></i>
                    <span class="stat-number" id="activeMonitors">0</span>
                    <div class="stat-label">ACTIVE MONITORS</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle stat-icon"></i>
                    <span class="stat-number" id="leaksDetected">0</span>
                    <div class="stat-label">LEAKS DETECTED</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock stat-icon"></i>
                    <span class="stat-number" id="uptime">00:00:00</span>
                    <div class="stat-label">SYSTEM UPTIME</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-tachometer-alt stat-icon"></i>
                    <span class="stat-number" id="avgResponseTime">0.0s</span>
                    <div class="stat-label">AVG RESPONSE TIME</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-microchip stat-icon"></i>
                    <span class="stat-number" id="cpuUsage">0%</span>
                    <div class="stat-label">CPU USAGE</div>
                </div>
            </div> -->
        </div>
    </div>

    <script>
        // Global variables
        let isMonitoring = false;
        let isPaused = false;
        let currentMode = 'upload';
        let statsInterval = null;

        // DOM elements
        const uploadMode = document.getElementById('uploadMode');
        const webcamMode = document.getElementById('webcamMode');
        const uploadArea = document.getElementById('uploadArea');
        const webcamBtn = document.getElementById('webcamBtn');
        const videoFile = document.getElementById('videoFile');
        const processBtn = document.getElementById('processBtn');
        const sensitivitySlider = document.getElementById('sensitivitySlider');
        const sensitivityValue = document.getElementById('sensitivityValue');
        const statusMessage = document.getElementById('statusMessage');
        const detectionControls = document.getElementById('detectionControls');
        const videoStream = document.getElementById('videoStream');
        const feedPlaceholder = document.getElementById('feedPlaceholder');
        
        // Control buttons
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Stats elements
        const activeMonitors = document.getElementById('activeMonitors');
        const leaksDetected = document.getElementById('leaksDetected');
        const uptime = document.getElementById('uptime');
        const avgResponseTime = document.getElementById('avgResponseTime');
        const neuralConfidence = document.getElementById('neuralConfidence');
        const cpuUsage = document.getElementById('cpuUsage');

        // Initialize the interface
        function init() {
            console.log('Initializing Neural Leak Detection Interface...');
            
            // Mode switching
            uploadMode.addEventListener('click', () => switchMode('upload'));
            webcamMode.addEventListener('click', () => switchMode('webcam'));
            
            // File upload
            uploadArea.addEventListener('click', () => videoFile.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            videoFile.addEventListener('change', handleFileSelect);
            
            // Webcam
            webcamBtn.addEventListener('click', startWebcamMonitoring);
            
            // Process button
            processBtn.addEventListener('click', startVideoMonitoring);
            
            // Sensitivity slider
            sensitivitySlider.addEventListener('input', updateSensitivity);
            
            // Control buttons
            pauseBtn.addEventListener('click', pauseMonitoring);
            resumeBtn.addEventListener('click', resumeMonitoring);
            stopBtn.addEventListener('click', stopMonitoring);
            resetBtn.addEventListener('click', resetMonitoring);
            
            // Start stats updates
            startStatsUpdates();
            
            console.log('Interface initialized successfully');
        }

        // Mode switching
        function switchMode(mode) {
            currentMode = mode;
            
            uploadMode.classList.toggle('active', mode === 'upload');
            webcamMode.classList.toggle('active', mode === 'webcam');
            
            uploadArea.style.display = mode === 'upload' ? 'block' : 'none';
            webcamBtn.style.display = mode === 'webcam' ? 'block' : 'none';
            
            // Reset process button
            processBtn.disabled = true;
            processBtn.innerHTML = '<i class="fas fa-play"></i> INITIATE NEURAL MONITORING';
        }

        // File handling
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect({ target: { files: files } });
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                console.log('File selected:', file.name);
                processBtn.disabled = false;
                processBtn.innerHTML = `<i class="fas fa-play"></i> START MONITORING: ${file.name}`;
                showStatus(`File selected: ${file.name}`, 'success');
            }
        }

        // Sensitivity control
        function updateSensitivity() {
            const value = sensitivitySlider.value;
            sensitivityValue.textContent = `${value}%`;
            
            // Update sensitivity if monitoring is active
            if (isMonitoring) {
                fetch('/api/neural/leak/sensitivity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sensitivity: parseInt(value) })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Sensitivity updated:', data);
                })
                .catch(error => {
                    console.error('Error updating sensitivity:', error);
                });
            }
        }

        // Start webcam monitoring
        function startWebcamMonitoring() {
            console.log('Starting webcam monitoring...');
            showStatus('Initializing webcam monitoring...', 'warning');
            
            const sensitivity = parseInt(sensitivitySlider.value);
            
            fetch('/api/neural/leak/webcam', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    sensitivity: sensitivity,
                    camera_index: 0 
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Webcam monitoring response:', data);
                
                if (data.status === 'NEURAL_MONITORING') {
                    startMonitoringUI();
                    showStatus('Webcam monitoring active', 'success');
                } else {
                    showStatus(`Error: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error starting webcam monitoring:', error);
                showStatus('Failed to start webcam monitoring', 'error');
            });
        }

        // Start video file monitoring
        function startVideoMonitoring() {
            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Please select a video file first', 'error');
                return;
            }

            console.log('Starting video monitoring...');
            showStatus('Uploading and processing video...', 'warning');
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('sensitivity', sensitivitySlider.value);
            
            processBtn.disabled = true;
            processBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSING...';
            
            fetch('/api/neural/leak/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log('Upload response:', data);
                
                if (data.status === 'NEURAL_MONITORING') {
                    startMonitoringUI();
                    showStatus('Video monitoring initiated successfully', 'success');
                } else {
                    showStatus(`Error: ${data.message}`, 'error');
                    processBtn.disabled = false;
                    processBtn.innerHTML = '<i class="fas fa-play"></i> INITIATE NEURAL MONITORING';
                }
            })
            .catch(error => {
                console.error('Error uploading video:', error);
                showStatus('Failed to upload video', 'error');
                processBtn.disabled = false;
                processBtn.innerHTML = '<i class="fas fa-play"></i> INITIATE NEURAL MONITORING';
            });
        }

        // Start monitoring UI
        function startMonitoringUI() {
            isMonitoring = true;
            isPaused = false;
            
            // Show video stream
            feedPlaceholder.style.display = 'none';
            videoStream.style.display = 'block';
            
            // Show controls
            detectionControls.classList.add('active');
            
            // Update button states
            processBtn.disabled = true;
            processBtn.innerHTML = '<i class="fas fa-eye"></i> MONITORING ACTIVE';
            
            // Add timestamp to video stream URL to force refresh
            videoStream.src = `/api/neural/leak/stream?t=${Date.now()}`;
            
            console.log('Monitoring UI started');
        }

        // Pause monitoring
        function pauseMonitoring() {
            if (!isMonitoring || isPaused) return;
            
            console.log('Pausing monitoring...');
            isPaused = true;
            
            // Update UI
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'inline-flex';
            
            // Hide video stream
            videoStream.style.display = 'none';
            feedPlaceholder.style.display = 'flex';
            feedPlaceholder.innerHTML = `
                <i class="fas fa-pause"></i>
                <p>MONITORING PAUSED</p>
                <p>Click RESUME to continue...</p>
            `;
            
            showStatus('Monitoring paused', 'warning');
        }

        // Resume monitoring
        function resumeMonitoring() {
            if (!isMonitoring || !isPaused) return;
            
            console.log('Resuming monitoring...');
            isPaused = false;
            
            // Update UI
            resumeBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-flex';
            
            // Show video stream
            feedPlaceholder.style.display = 'none';
            videoStream.style.display = 'block';
            videoStream.src = `/api/neural/leak/stream?t=${Date.now()}`;
            
            showStatus('Monitoring resumed', 'success');
        }

        // Stop monitoring
        function stopMonitoring() {
            if (!isMonitoring) return;
            
            console.log('Stopping monitoring...');
            
            fetch('/api/neural/leak/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Stop response:', data);
                stopMonitoringUI();
                showStatus('Monitoring terminated', 'success');
            })
            .catch(error => {
                console.error('Error stopping monitoring:', error);
                stopMonitoringUI();
                showStatus('Monitoring stopped (with errors)', 'warning');
            });
        }

        // Stop monitoring UI
        function stopMonitoringUI() {
            isMonitoring = false;
            isPaused = false;
            
            // Hide video stream and controls
            videoStream.style.display = 'none';
            detectionControls.classList.remove('active');
            
            // Show placeholder
            feedPlaceholder.style.display = 'flex';
            feedPlaceholder.innerHTML = `
                <i class="fas fa-video"></i>
                <p>NEURAL MONITORING STANDBY</p>
                <p>Awaiting video source for leak detection...</p>
            `;
            
            // Reset buttons
            processBtn.disabled = currentMode === 'upload' ? !videoFile.files[0] : false;
            processBtn.innerHTML = '<i class="fas fa-play"></i> INITIATE NEURAL MONITORING';
            
            pauseBtn.style.display = 'inline-flex';
            resumeBtn.style.display = 'none';
            
            console.log('Monitoring UI stopped');
        }

        // Reset monitoring (reset leak counter)
        function resetMonitoring() {
            console.log('Resetting monitoring...');
            
            fetch('/api/neural/leak/reset', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Reset response:', data);
                showStatus('Leak counter reset', 'success');
                updateStats(); // Force stats update
            })
            .catch(error => {
                console.error('Error resetting monitoring:', error);
                showStatus('Failed to reset counter', 'error');
            });
        }

        // Show status message
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Start statistics updates
        function startStatsUpdates() {
            // Initial update
            updateStats();
            
            // Update every 2 seconds
            statsInterval = setInterval(updateStats, 2000);
        }

        // Update statistics
        function updateStats() {
            fetch('/api/neural/leak/stats')
                .then(response => response.json())
                .then(data => {
                    console.log('Stats updated:', data);
                    
                    // Check if it's the enhanced stats format
                    if (data.monitoring_data) {
                        // Enhanced format from app.py
                        activeMonitors.textContent = data.monitoring_data.active_monitors;
                        leaksDetected.textContent = data.monitoring_data.leaks_detected;
                        uptime.textContent = data.monitoring_data.system_uptime;
                        avgResponseTime.textContent = data.monitoring_data.avg_response_time;
                        neuralConfidence.textContent = data.monitoring_data.neural_confidence || '95%';
                        cpuUsage.textContent = data.system_health?.cpu_usage || '45%';
                    } else {
                        // Basic format from WaterLeakage.py
                        activeMonitors.textContent = data.active_monitors || 0;
                        leaksDetected.textContent = data.leaks_detected || 0;
                        uptime.textContent = data.uptime || '00:00:00';
                        avgResponseTime.textContent = data.avg_response_time || '0.0s';
                        neuralConfidence.textContent = '95%'; // Default
                        cpuUsage.textContent = '45%'; // Default
                    }
                })
                .catch(error => {
                    console.error('Error updating stats:', error);
                    // Set default values on error
                    activeMonitors.textContent = isMonitoring ? '1' : '0';
                    neuralConfidence.textContent = '95%';
                    cpuUsage.textContent = '45%';
                });
        }

        // Handle video stream errors
        function handleVideoError() {
            console.log('Video stream error detected');
            videoStream.style.display = 'none';
            feedPlaceholder.style.display = 'flex';
            feedPlaceholder.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <p>VIDEO STREAM ERROR</p>
                <p>Attempting to reconnect...</p>
            `;
            
            // Try to reconnect after 3 seconds
            setTimeout(() => {
                if (isMonitoring && !isPaused) {
                    videoStream.src = `/api/neural/leak/stream?t=${Date.now()}`;
                    videoStream.style.display = 'block';
                    feedPlaceholder.style.display = 'none';
                }
            }, 3000);
        }

        // Add error handler to video stream
        document.addEventListener('DOMContentLoaded', function() {
            videoStream.addEventListener('error', handleVideoError);
            videoStream.addEventListener('load', function() {
                console.log('Video stream loaded successfully');
            });
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (statsInterval) {
                clearInterval(statsInterval);
            }
            if (isMonitoring) {
                fetch('/api/neural/leak/stop', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                }).catch(() => {}); // Ignore errors on page unload
            }
        });

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', init);

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case ' ': // Ctrl+Space to pause/resume
                        e.preventDefault();
                        if (isMonitoring) {
                            if (isPaused) {
                                resumeMonitoring();
                            } else {
                                pauseMonitoring();
                            }
                        }
                        break;
                    case 's': // Ctrl+S to stop
                        e.preventDefault();
                        if (isMonitoring) {
                            stopMonitoring();
                        }
                        break;
                    case 'r': // Ctrl+R to reset
                        e.preventDefault();
                        if (isMonitoring) {
                            resetMonitoring();
                        }
                        break;
                }
            }
        });

        console.log('Neural Leak Detection System Loaded');
    </script>
</body>
</html>